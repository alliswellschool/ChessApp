<div class="knights-tour-container">
  <div class="game-header">
    <h1>Knight's Tour</h1>
    <p>Visit all 64 squares exactly once using only knight moves (L-shape: 2 squares in one direction, 1 in perpendicular).</p>
    
    <div class="message-bar">
      <div *ngIf="isComplete" class="victory optimal">
        üéâ Congratulations! You completed the Knight's Tour!
      </div>
      <div *ngIf="isStuck" class="warning">
        ‚ö†Ô∏è No valid moves left. You're stuck! Try resetting.
      </div>
      <div *ngIf="!gameStarted" class="info">
        Click any square to place the knight and start the tour.
      </div>
    </div>
  </div>

  <div class="game-content">
    <div class="left-panel">
      <div class="stats-panel">
        <h3>Tour Progress</h3>
        <div class="stat-item">
          <span class="stat-label">Squares Visited:</span>
          <span class="stat-value">{{ squaresVisited }} / {{ totalSquares }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Moves:</span>
          <span class="stat-value">{{ moveCount }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Valid Moves:</span>
          <span class="stat-value">{{ hasValidMoves ? getValidMoves().length : 0 }}</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="(squaresVisited / totalSquares) * 100"></div>
        </div>
      </div>

      <div class="controls">
        <button class="toggle-btn" [class.active]="showValidMoves" (click)="showValidMoves = !showValidMoves; updateCells()">
          <span class="toggle-slider"></span>
          <span class="toggle-label">Show Valid Moves</span>
        </button>
        <button class="reset-btn" (click)="undo()" [disabled]="moveHistory.length === 0">Undo</button>
        <button class="reset-btn" (click)="reset()">Reset Tour</button>
      </div>

      <div class="info-panel">
        <h3>How to Play</h3>
        <ul>
          <li>Click any square to start</li>
          <li>Move in L-shape only</li>
          <li>Visit each square once</li>
          <li>Green dots = valid moves</li>
          <li>Green squares = visited</li>
        </ul>
      </div>
    </div>

    <!-- Reusable Chessboard Component -->
    <app-chessboard
      [size]="size"
      [cells]="cells"
      [showCoordinates]="true"
      [interactive]="true"
      (cellClick)="onCellClick($event)">
    </app-chessboard>
  </div>
  
  <!-- Victory Modal (Perfect Tour - 64 moves) -->
  <app-victory-modal
    [show]="showVictoryModal"
    title="Perfect Tour!"
    message="Congratulations! You completed a perfect Knight's Tour in 64 moves!"
    [stats]="victoryStats"
    [buttons]="victoryButtons"
    (closeModal)="showVictoryModal = false"
    (buttonClick)="handleVictoryAction($event)">
  </app-victory-modal>

  <!-- Completion Modal (All squares visited but not perfect) -->
  <app-victory-modal
    [show]="showCompletionModal"
    title="Tour Complete!"
    [message]="completionMessage"
    [stats]="victoryStats"
    [buttons]="completionButtons"
    (closeModal)="showCompletionModal = false"
    (buttonClick)="handleCompletionAction($event)">
  </app-victory-modal>
</div>
