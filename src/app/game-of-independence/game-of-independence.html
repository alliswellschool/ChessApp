<div class="independence-root">
  <div class="header">
    <h1>Games of Independence</h1>
    <p>Choose a mode and board size, then place pieces so that no two pieces meet each other.</p>

    <!-- Size controls placed directly under the header to match Dominance UI -->
    <div class="size-controls" *ngIf="mode==='single'">
      <label class="size-label">Board Size:</label>
      <div class="size-buttons">
        <button *ngFor="let s of availableSizes" class="size-btn" [class.active]="size===s" (click)="setSize(s)">{{s}}Ã—{{s}}</button>
      </div>
    </div>
  </div>

  <div class="controls-and-board">
    <div class="left">
      <div class="mode-toggle">
        <button [class.active]="mode==='single'" (click)="setMode('single')">Single</button>
        <button [class.active]="mode==='team'" (click)="setMode('team')">Team</button>
      </div>

      <!-- size controls removed from left panel (now under header) -->

      <app-piece-selector
        [pieces]="availablePieces"
        [selectedPiece]="selected"
        [showCounts]="true"
        [pieceCounts]="pieceCountsMap"
        (pieceSelected)="onPieceSelected($event)">
      </app-piece-selector>

      <div class="controls">
        <button class="toggle-btn" [class.active]="highlightPath" (click)="highlightPath = !highlightPath">
          <span class="toggle-slider"></span>
          <span class="toggle-label">Show Highlights</span>
        </button>
        <button class="reset-btn" (click)="resetBoard()">Reset Board</button>
      </div>
      

      <!-- Placement summary for single mode: only show number of valid placements made -->
      <div class="placement-single" [class.needs-attention]="validCounts[selected] !== requiredPieces" *ngIf="mode==='single'">
        <h4>Placement Stats</h4>
        <div class="stat-row">
          <span class="stat-name">Valid placements:</span>
          <span class="stat-value">{{ validCounts[selected] }} / {{ requiredPieces }}</span>
        </div>
      </div>


      <!-- <div class="stats" *ngIf="mode==='team'">
        <h4>Placement</h4>
        <div *ngFor="let p of pieces" class="stat-row">
          <span class="stat-name">{{ getPieceSymbol(p) }}</span>
          <span class="stat-value">{{ placedCounts[p] }} / {{ requiredCounts[p] }}</span>
        </div>
        <div class="victory" *ngIf="isSolved">ðŸŽ‰ All placed correctly â€” you win!</div>
      </div> -->
    </div>
    <hr>
    <div class="board">
      <app-chessboard [size]="size" [cells]="cells" [showCoordinates]="true" [interactive]="true"
        (cellClick)="placeOrRemove($event.row, $event.col)">
      </app-chessboard>
    </div>
    <hr>

    <!-- How to Play Section - Right Side -->
    <div class="info-panel-right">
      <h3>How to Play</h3>
      <ul>
        <li>Select Single or Team mode</li>
        <li>Choose a piece type</li>
        <li>Place pieces on board</li>
        <li>Pieces must NOT attack each other</li>
        <li>Goal: Place maximum pieces independently</li>
        <li>Red highlights show conflicts</li>
      </ul>
    </div>
  </div>

  <!-- Piece Change Confirmation Modal -->
  <div class="modal-overlay" *ngIf="showPieceChangeModal" (click)="closePieceChangeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Switch Piece Type?</h2>
      </div>
      <div class="modal-body">
        <p>You have <strong>{{ currentPieceCount }} {{ selected }}(s)</strong> on the board.</p>
        <p>Switching to <strong>{{ pendingPieceChange }}</strong> will reset the board.</p>
        <p>Do you want to continue?</p>
      </div>
      <div class="modal-footer">
        <button class="modal-btn cancel-btn" (click)="closePieceChangeModal()">Cancel</button>
        <button class="modal-btn confirm-btn" (click)="confirmPieceChange()">Reset & Switch</button>
      </div>
    </div>
  </div>

  <!-- Victory Modal -->
  <app-victory-modal
    [show]="showVictoryModal"
    [title]="mode === 'single' ? 'Victory!' : 'Team Victory!'"
    [message]="victoryMessage"
    [buttons]="victoryButtons"
    (closeModal)="closeVictoryModal()"
    (buttonClick)="handleVictoryAction($event)">
  </app-victory-modal>
</div>
