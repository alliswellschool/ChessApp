<div class="capture-root">
  <div class="header">
    <h1>Capture the Shapes</h1>
   
    
    <div class="puzzle-nav">
      <button class="nav-btn" (click)="previousBoard()" [disabled]="currentBoardIndex === 0">
        ‚Üê Previous Board
      </button>
      <span class="puzzle-number" [class.completed]="isCompletedBoard(currentBoardIndex)">Board {{ currentBoardIndex + 1 }} / 3</span>
      <button class="nav-btn" (click)="nextBoard()" [disabled]="currentBoardIndex === 2">
        Next Board ‚Üí
      </button>
    </div>

    <div class="message-bar">
      <div *ngIf="gameCompleted" class="victory optimal">
        üéâ Perfect! All {{ totalShapes }} shapes captured in {{ moveCount }} moves.
      </div>
      <!-- <div *ngIf="!gameCompleted" class="info-message">
        Move your {{ currentPuzzle.pieceType | titlecase }} to capture all shapes
      </div> -->
    </div>
  </div>

  <div class="controls-and-board">
    <div class="left">
      <div class="piece-selector-wrapper">
        <label>Select Piece:</label>
        <app-piece-selector
          [pieces]="availablePieceInfo"
          [selectedPiece]="currentSelectedPieceType"
          [completedPieces]="completedPieces"
          (pieceSelected)="onPieceSelected($event)">
        </app-piece-selector>
      </div>
      
      <div class="position-info-panel">
        <h4>Position Variant</h4>
        <div class="position-details">
          <div class="position-nav-row">
            <button class="position-btn" (click)="previousPosition()" [disabled]="currentPositionIndex === 0">‚Üê</button>
            <span class="position-number">{{ currentPositionIndex + 1 }} / {{ maxPositions }}</span>
            <button class="position-btn" (click)="nextPosition()" [disabled]="currentPositionIndex === maxPositions - 1">‚Üí</button>
          </div>
          <div class="current-position">
            <span class="position-label">Start Square:</span>
            <span class="position-value">{{ currentPuzzle.startSquare }}</span>
          </div>
        </div>
      </div>

      <div class="controls">
        <button class="toggle-btn" [class.active]="showValidMoves" 
                (click)="showValidMoves = !showValidMoves">
          <span class="toggle-slider"></span>
          <span class="toggle-label">Show Valid Moves</span>
        </button>
        <button class="reset-btn" (click)="undoMove()" [disabled]="moveHistory.length <= 1">Undo Move</button>
        <button class="reset-btn" (click)="reset()">Reset Puzzle</button>
      </div>

      <div class="stats-panel">
        <h4>Progress</h4>
        <div class="stat-row">
          <span class="stat-name">Moves:</span>
          <span class="stat-value">{{ moveCount }}</span>
        </div>
        <div class="stat-row" *ngIf="getBestScore()">
          <span class="stat-name">Best Score:</span>
          <span class="stat-value best-score">{{ getBestScore() }}</span>
        </div>
        <div class="stat-row">
          <span class="stat-name">Shapes Captured:</span>
          <span class="stat-value">{{ capturedCount }} / {{ totalShapes }}</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="progressPercentage"></div>
        </div>
      </div>
    </div>

    <div class="board">
      <app-chessboard
        [size]="size"
        [cells]="cells"
        [showCoordinates]="true"
        [interactive]="true"
        (cellClick)="onCellClicked($event.row, $event.col)">
      </app-chessboard>
    </div>

    <!-- How to Play Section - Right Side -->
    <div class="info-panel-right">
      <h3>How to Play</h3>
      <ul>
        <li>Click start square to pick up piece</li>
        <li>Capture all shapes (‚óÜ, ‚ñ≤, ‚óè, ‚ñ†)</li>
        <li>Each piece moves differently</li>
        <li>Use fewest moves possible</li>
        <li>Navigate between puzzles</li>
        <li>Filter by piece type</li>
      </ul>
    </div>
  </div>

  <!-- Victory Modal -->
  <div class="modal-overlay" *ngIf="gameCompleted" (click)="gameCompleted = false">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>üéâ Puzzle Completed!</h2>
      </div>
      <div class="modal-body">
        <p class="modal-message">You've successfully captured all shapes!</p>
        <div class="modal-stats">
          <div class="modal-stat">
            <span class="modal-stat-label">Moves:</span>
            <span class="modal-stat-value">{{ moveCount }}</span>
          </div>
          <div class="modal-stat" *ngIf="getBestScore() && moveCount === getBestScore()">
            <span class="modal-stat-label">üèÜ New Record!</span>
            <span class="modal-stat-value">{{ moveCount }}</span>
          </div>
          <div class="modal-stat" *ngIf="getBestScore() && moveCount !== getBestScore()">
            <span class="modal-stat-label">Best Score:</span>
            <span class="modal-stat-value">{{ getBestScore() }}</span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="modal-btn primary" (click)="nextPosition()">Next Position</button>
        <button class="modal-btn secondary" (click)="reset()">Try Again</button>
      </div>
    </div>
  </div>

</div>
