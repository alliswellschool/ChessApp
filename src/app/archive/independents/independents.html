<div class="dominance-container">
  <div class="game-header">
    <h1>Games of Independence</h1>
    <p>Choose a mode and board size, then place pieces so that no two pieces meet each other.</p>
  </div>

  <div class="size-controls" *ngIf="mode !== 'team'">
    <label>Board Size:</label>
    <button *ngFor="let s of availableSizes" 
            [class.active]="size === s"
            (click)="setSize(s)">
      {{ s }}Ã—{{ s }}
    </button>
  </div>

  <div class="game-content" style="gap: 16px; align-items: stretch;">
    <div class="left-panel" style="width: 320px;">
      <div class="mode-toggle" aria-label="Choose independence mode">
        <button class="mode-btn" [class.active]="mode === 'single'" (click)="setMode('single')">Single</button>
        <button class="mode-btn" [class.active]="mode === 'team'" (click)="setMode('team')">Team</button>
      </div>
      <div class="piece-selector" *ngIf="mode === 'single'">
        <h3>Select Piece</h3>
        <div class="piece-buttons">
          <button *ngFor="let m of modes.slice(0, 6)" 
                  class="piece-btn" 
                  [class.selected]="selected===m.key" 
                  (click)="selected = m.key">
            <div class="piece-symbol" [style.background-image]="'url(' + getImage(m.key) + ')'"></div>
            <span class="piece-name">{{ m.label }}</span>
          </button>
        </div>
      </div>
      
      <!-- Team mode: render all-pieces controls in left panel -->
      <ng-container *ngIf="selected === 'all' && allPiecesComponent">
        <div class="piece-selector">
          <h3>Select Piece</h3>
          <div class="piece-buttons">
            <button *ngFor="let p of allPiecesComponent.pieces" 
                    class="piece-btn" 
                    [class.selected]="allPiecesComponent.selected===p" 
                    [class.disabled]="allPiecesComponent.getPlaced(p) >= allPiecesComponent.getRequired(p)"
                    (click)="allPiecesComponent.selected = p" 
                    [attr.aria-pressed]="allPiecesComponent.selected===p"
                    [title]="p.charAt(0).toUpperCase() + p.slice(1)">
              <div class="piece-symbol" [style.background-image]="'url(' + allPiecesComponent.getImage(p) + ')'"></div>
              <span class="piece-count">{{ allPiecesComponent.getPlaced(p) }} / {{ allPiecesComponent.getRequired(p) }}</span>
            </button>
          </div>
        </div>

        <div class="controls">
          <button class="toggle-btn" [class.active]="allPiecesComponent.highlightPath" (click)="allPiecesComponent.highlightPath = !allPiecesComponent.highlightPath">
            <span class="toggle-slider"></span>
            <span class="toggle-label">Show Highlights</span>
          </button>
          <button class="reset-btn" (click)="allPiecesComponent.resetBoard()">Reset Board</button>
        </div>

        <div class="stats-panel">
          <h3>Placement Stats</h3>
          <div class="stat-item" *ngFor="let p of allPiecesComponent.pieces">
            <span class="stat-label">{{ p }}:</span>
            <span class="stat-value">{{ allPiecesComponent.getPlaced(p) }} / {{ allPiecesComponent.getRequired(p) }}</span>
          </div>
          <div class="stat-item" *ngFor="let p of allPiecesComponent.pieces">
            <span class="stat-label">Valid {{ p }}:</span>
            <span class="stat-value" [style.color]="allPiecesComponent.getValid(p) === allPiecesComponent.getRequired(p) ? '#10b981' : '#ef4444'">{{ allPiecesComponent.getValid(p) }} / {{ allPiecesComponent.getRequired(p) }}</span>
          </div>
        </div>

        <!-- Message bar -->
        <div class="message-bar" *ngIf="allPiecesComponent.isSolved" style="margin-top: 16px;">
          <div class="victory optimal">ðŸŽ‰ All pieces placed â€” you win!</div>
        </div>
      </ng-container>
    </div>

    <div class="board-container" style="min-width: 520px;">
      <app-eight-queens *ngIf="selected === 'queens'" [size]="size"></app-eight-queens>
      <app-bishops *ngIf="selected === 'bishops'" [size]="size"></app-bishops>
      <app-knights *ngIf="selected === 'knights'" [size]="size"></app-knights>
      <app-rooks *ngIf="selected === 'rooks'" [size]="size"></app-rooks>
      <app-kings *ngIf="selected === 'kings'" [size]="size"></app-kings>
      <app-pawns *ngIf="selected === 'pawns'" [size]="size"></app-pawns>
      
      <!-- Team mode: render board on the right -->
      <ng-container *ngIf="selected === 'all'">
        <app-all-pieces #allPiecesComponent></app-all-pieces>
      </ng-container>
    </div>
  </div>
</div>
