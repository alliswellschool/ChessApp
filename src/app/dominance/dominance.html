<div class="dominance-container">
  <div class="game-header">
    <h1>Games of Dominance</h1>
    <p>Arrange pieces so that all 64 squares are controlled. The pieces can meet each other.</p>
    <div class="message-bar">
      <ng-container *ngIf="mode === 'single'">
        <div *ngIf="hasWon" class="victory" [class.optimal]="isOptimal">
          {{ getVictoryMessage() }}
        </div>
      </ng-container>
      <ng-container *ngIf="mode === 'team'">
        <div *ngIf="hasWon" class="victory optimal">
          {{ getVictoryMessage() }}
        </div>
        <div *ngIf="!hasWon && dominationPercentage === 100" class="victory">
          ✓ All squares controlled, but the counts must be exactly King×1, Queen×1, Rooks×2, Bishops×2, Knights×2.
        </div>
      </ng-container>
    </div>
  </div>

  <div class="size-controls" *ngIf="mode !== 'team'">
    <label>Board Size:</label>
    <button *ngFor="let s of availableSizes" 
            [class.active]="size === s"
            (click)="changeSize(s)">
      {{ s }}×{{ s }}
    </button>
  </div>

  <div class="game-content">
    <div class="left-panel">
      <div class="mode-toggle" aria-label="Choose dominance mode">
        <button class="mode-btn" [class.active]="mode === 'single'" (click)="setMode('single')">Single</button>
        <button class="mode-btn" [class.active]="mode === 'team'" (click)="setMode('team')">Team</button>
      </div>
      <app-piece-selector
        [pieces]="availablePieces"
        [selectedPiece]="selectedPiece"
        [showCounts]="true"
        [pieceCounts]="pieceCountsMap"
        (pieceSelected)="selectPiece($event)">
      </app-piece-selector>

      <div class="controls">
        <button class="toggle-btn" [class.active]="highlightDominated" (click)="highlightDominated = !highlightDominated">
          <span class="toggle-slider"></span>
          <span class="toggle-label">Show Dominated</span>
        </button>
        <button class="reset-btn" (click)="resetBoard()">Reset Board</button>
      </div>

      <div class="stats-panel">
        <h3>Domination Stats</h3>
        <div class="stat-item">
          <span class="stat-label">Total Pieces:</span>
          <span class="stat-value">{{ getTotalPieces() }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Squares Dominated:</span>
          <span class="stat-value">{{ dominationCount }} / {{ size * size }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Coverage:</span>
          <span class="stat-value">{{ dominationPercentage }}%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="dominationPercentage"></div>
        </div>
      </div>
    </div>

    <!-- Reusable Chessboard Component -->
    <app-chessboard
      [size]="size"
      [cells]="cells"
      [showCoordinates]="true"
      [interactive]="true"
      (cellClick)="onCellClick($event)">
    </app-chessboard>
  </div>

  <!-- Victory Modal -->
  <app-victory-modal
    [show]="showVictoryModal"
    title="Puzzle Completed!"
    [message]="getVictoryMessage()"
    [stats]="victoryStats"
    [buttons]="victoryButtons"
    (closeModal)="showVictoryModal = false"
    (buttonClick)="handleVictoryAction($event)">
  </app-victory-modal>

  <!-- Full Coverage Modal (100% but wrong piece count) -->
  <app-victory-modal
    [show]="showFullCoverageModal"
    title="Full Coverage!"
    [message]="fullCoverageMessage"
    [stats]="victoryStats"
    [buttons]="fullCoverageButtons"
    (closeModal)="showFullCoverageModal = false"
    (buttonClick)="handleFullCoverageAction($event)">
  </app-victory-modal>
</div>
