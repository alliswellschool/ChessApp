<div class="dominance-container">
  <div class="game-header">
    <h1>Games of Dominance</h1>
    <p>Arrange pieces so that all 64 squares are controlled. The pieces can meet each other.</p>
    <div class="message-bar">
      <ng-container *ngIf="mode === 'single'">
        <div *ngIf="hasWon" class="victory" [class.optimal]="isOptimal">
          {{ getVictoryMessage() }}
        </div>
      </ng-container>
      <ng-container *ngIf="mode === 'team'">
        <div *ngIf="hasWon" class="victory optimal">
          {{ getVictoryMessage() }}
        </div>
        <div *ngIf="!hasWon && dominationPercentage === 100" class="victory">
          ‚úì All squares controlled, but the counts must be exactly King√ó1, Queen√ó1, Rooks√ó2, Bishops√ó2, Knights√ó2.
        </div>
      </ng-container>
    </div>
  </div>

  <div class="size-controls" *ngIf="mode !== 'team'">
    <label>Board Size:</label>
    <button *ngFor="let s of availableSizes" 
            [class.active]="size === s"
            (click)="changeSize(s)">
      {{ s }}√ó{{ s }}
    </button>
  </div>

  <div class="game-content">
    <div class="left-panel">
      <div class="mode-toggle" aria-label="Choose dominance mode">
        <button class="mode-btn" [class.active]="mode === 'single'" (click)="setMode('single')">Single</button>
        <button class="mode-btn" [class.active]="mode === 'team'" (click)="setMode('team')">Team</button>
      </div>
      <app-piece-selector
        [pieces]="availablePieces"
        [selectedPiece]="selectedPiece"
        [showCounts]="true"
        [pieceCounts]="pieceCountsMap"
        (pieceSelected)="selectPiece($event)">
      </app-piece-selector>

      <div class="controls">
        <button class="toggle-btn" [class.active]="highlightDominated" (click)="highlightDominated = !highlightDominated">
          <span class="toggle-slider"></span>
          <span class="toggle-label">Show Dominated</span>
        </button>
        <button class="reset-btn" (click)="resetBoard()">Reset Board</button>
      </div>

      <div class="stats-panel">
        <h3>Domination Stats</h3>
        <div class="stat-item">
          <span class="stat-label">Total Pieces:</span>
          <span class="stat-value">{{ getTotalPieces() }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Squares Dominated:</span>
          <span class="stat-value">{{ dominationCount }} / {{ size * size }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Coverage:</span>
          <span class="stat-value">{{ dominationPercentage }}%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="dominationPercentage"></div>
        </div>
      </div>
    </div>

    <!-- Reusable Chessboard Component -->
    <app-chessboard
      [size]="size"
      [cells]="cells"
      [showCoordinates]="true"
      [interactive]="true"
      (cellClick)="onCellClick($event)">
    </app-chessboard>
  </div>

  <!-- Victory Modal -->
  <div class="modal-overlay" *ngIf="showVictoryModal" (click)="closeVictoryModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>üéâ Puzzle Completed!</h2>
      </div>
      <div class="modal-body">
        <p class="modal-message">{{ getVictoryMessage() }}</p>
        <div class="modal-stats">
          <div class="modal-stat">
            <span class="modal-stat-label">Pieces Used:</span>
            <span class="modal-stat-value">{{ mode === 'single' ? pieceCounts[selectedPiece] : getTotalPieces() }}</span>
          </div>
          <div class="modal-stat">
            <span class="modal-stat-label">Board Size:</span>
            <span class="modal-stat-value">{{ size }}√ó{{ size }}</span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="modal-btn primary" (click)="closeVictoryModal()">Continue</button>
        <button class="modal-btn secondary" (click)="selectNextPiece()">Next Piece</button>
      </div>
    </div>
  </div>
</div>
